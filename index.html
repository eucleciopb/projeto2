<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Controle de Solicita√ß√µes de Mochilas</title>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Poppins", sans-serif; }

    body {
      background: #121212;
      color: #333;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      padding: 30px;
      width: 100%;
      max-width: 1100px;
      animation: fadeIn 0.6s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      text-align: center;
      color: #222;
      margin-bottom: 20px;
      font-size: 1.8rem;
    }

    form {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    label {
      font-weight: 600;
      color: #444;
      font-size: 0.9rem;
    }

    input, select, textarea {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 0.9rem;
      transition: 0.2s;
      width: 100%;
    }

    input:focus, select:focus, textarea:focus {
      border-color: #007bff;
      outline: none;
      box-shadow: 0 0 5px rgba(0,123,255,0.3);
    }

    .full { grid-column: span 3; }

    button {
      background: #007bff;
      color: white;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover { background: #0056b3; }

    .search-box {
      margin-bottom: 10px;
      text-align: right;
    }

    .search-box input {
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 0.9rem;
      width: 250px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: left;
      font-size: 0.9rem;
    }

    th { background: #f7f7f7; font-weight: 600; }

    tr:hover { background: #f1f1f1; }

    .edit-btn, .delete-btn {
      border: none;
      border-radius: 6px;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: 0.3s;
      color: white;
      font-weight: 600;
    }

    .edit-btn { background: #28a745; }
    .edit-btn:hover { background: #218838; }
    .delete-btn { background: #dc3545; }
    .delete-btn:hover { background: #b02a37; }

    footer {
      text-align: center;
      margin-top: 20px;
      font-size: 0.8rem;
      color: #666;
    }

    @media (max-width: 800px) {
      form { grid-template-columns: 1fr; }
      .full { grid-column: span 1; }
      .search-box { text-align: center; }
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>üéí Controle de Solicita√ß√µes de Mochilas</h1>

    <form id="formMochila">
      <div>
        <label for="cd">Centro de Distribui√ß√£o (CD)</label>
        <select id="cd" required>
          <option value="">Selecione...</option>
        </select>
      </div>

      <div>
        <label for="nome">Nome do Solicitante</label>
        <input type="text" id="nome" required placeholder="Ex: Jo√£o Silva">
      </div>

      <div>
        <label for="cargo">Cargo</label>
        <select id="cargo" required>
          <option value="">Selecione...</option>
          <option value="AC">AC</option>
          <option value="SV">SV</option>
          <option value="GG">GG</option>
          <option value="GV">GV</option>
          <option value="ADM">ADM</option>
          <option value="Financeiro">Financeiro</option>
        </select>
      </div>

      <div>
        <label for="tipo">Tipo de Solicita√ß√£o</label>
        <select id="tipo" required>
          <option value="Mochila">Mochila</option>
        </select>
      </div>

      <div>
        <label for="data">Data da Solicita√ß√£o</label>
        <input type="date" id="data" required>
      </div>

      <div>
        <label for="qtdSolicitada">Total de Mochilas Solicitadas</label>
        <input type="number" id="qtdSolicitada" min="1" required>
      </div>

      <div>
        <label for="qtdAprovada">Total de Mochilas Aprovadas</label>
        <input type="number" id="qtdAprovada" min="0" required>
      </div>

      <div class="full">
        <label for="obs">Observa√ß√µes</label>
        <textarea id="obs" rows="2" placeholder="Informa√ß√µes adicionais" required></textarea>
      </div>

      <div class="full">
        <button type="submit">Salvar Solicita√ß√£o</button>
      </div>
    </form>

    <div class="search-box">
      <input type="text" id="pesquisa" placeholder="üîç Pesquisar por CD ou nome...">
    </div>

    <table id="tabelaMochilas">
      <thead>
        <tr>
          <th>CD</th>
          <th>Solicitante</th>
          <th>Cargo</th>
          <th>Tipo</th>
          <th>Data</th>
          <th>Solicitadas</th>
          <th>Aprovadas</th>
          <th>Obs</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <footer>¬© 2025 - Controle de Mochilas</footer>
  </div>

  <!-- üî• Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, query, where } 
      from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBcXTj40CI4fEJOGp2T_ghh3Wwpki4OnW0",
      authDomain: "salasdereunioes-eb91a.firebaseapp.com",
      projectId: "salasdereunioes-eb91a",
      storageBucket: "salasdereunioes-eb91a.firebasestorage.app",
      messagingSenderId: "961898084996",
      appId: "1:961898084996:web:535185ceb0860e1e06e0d1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const cds = [
      "Alagoinhas","Andradina","Angra dos Reis","Aparecida de Goi√¢nia","Ara√ßatuba","Arapiraca","Araraquara",
      "Balsas","Barbalha","Barra do Garca","Barreiras","Barretos","Barueri","Bauru","Bel√©m","Boa Vista","Boituva",
      "Bom Jesus da Lapa","Brumado","Cachoeiro de Itapemirim","Cama√ßari","Campina Grande","Campinas","Campo Grande MS",
      "Campo Grande RJ","Campos dos Goytacazes","Caraguatatuba","Cariacica","Carpina","Caruaru","Cascavel","Catanduva",
      "Caucaia","Caxias","Coimbra","Conde","Conselheiro Lafaiete","Contagem","Coxim","Cuiab√°","Divin√≥polis","Dourados",
      "Duque de Caxias","Eun√°polis","Eusebio","Feira de Santana","Fernand√≥polis","Floriano","Garanhuns","Governador Valadares",
      "Guaruj√°","Guarulhos Tabo√£o","Iguatu","Imperatriz","Interlagos","Ipor√°","Irece","Itabaiana","Itaberaba","Itabuna",
      "Itacoatiara","Itapeva","Itapissuma","Itumbiara","Iuna","Jaboat√£o dos Guararapes","Jacobina","Jaguar√©","Jequi√©",
      "Juazeiro","Juiz de Fora","Jundia√≠","Londrina","Macaiba","Macei√≥","Manaus","Mar√≠lia","Mogi-Mirim","Montes Claros",
      "Mossor√≥","Muria√©","Nossa Senhora do Socorro","Nova Friburgo","Palho√ßa","Parana√≠ba","Parintins","Parnaiba","Passos",
      "Patos","Paulo Afonso","Petrolina","Petr√≥polis","Picos","Piracicaba","Po√ßos de Caldas","Porto Ferreira","Porto Velho",
      "Pouso Alegre","Praia Grande","Presidente Prudente","Recife","Registro","Ribeir√£o Preto","Rio Branco","Rio das Ostras",
      "Rio Verde","Rondon√≥polis","Salto","Salvador","Salvador Leste","Santa In√™s","Santa Teresa","Santo Antonio de Jesus",
      "S√£o Bernardo","S√£o Cristov√£o","S√£o Gon√ßalo","S√£o Jo√£o de Meriti","S√£o Jos√© do Rio Preto","S√£o Jos√© dos Campos",
      "S√£o Jos√© dos Pinhais","S√£o Luis","S√£o Mateus","S√£o Pedro da Aldeia","Sapucaia do Sul","Serra Talhada","Serrinha",
      "Sete Lagoas","Sinop","Sobral","Sousa","Suzano","Tabatinga","Tabo√£o da Serra","Taguatinga","Taubat√©","Teixeira de Freitas",
      "Teresina","Tr√™s Lagoas","Uberaba","Uberl√¢ndia","Varginha","Vila Guilherme","Vit√≥ria da Conquista","Volta Redonda"
    ];

    const cdSelect = document.getElementById('cd');
    cds.forEach(cd => {
      const opt = document.createElement('option');
      opt.value = cd;
      opt.textContent = "CD - " + cd;
      cdSelect.appendChild(opt);
    });

    const form = document.getElementById('formMochila');
    const tabela = document.querySelector('#tabelaMochilas tbody');
    const pesquisa = document.getElementById('pesquisa');
    let editandoId = null;

    async function carregar() {
      const snapshot = await getDocs(collection(db, "solicitacoes"));
      tabela.innerHTML = "";
      snapshot.forEach(docItem => addLinha(docItem.id, docItem.data()));
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const dados = {
        cd: cdSelect.value,
        nome: nome.value.trim(),
        cargo: cargo.value,
        tipo: tipo.value,
        data: data.value,
        qtdSolicitada: parseInt(qtdSolicitada.value),
        qtdAprovada: parseInt(qtdAprovada.value),
        obs: obs.value.trim()
      };

      if (Object.values(dados).some(v => v === "" || v === null || isNaN(v) && typeof v !== "string")) {
        alert("Todos os campos s√£o obrigat√≥rios!");
        return;
      }

      const snapshot = await getDocs(collection(db, "solicitacoes"));
      const duplicado = snapshot.docs.find(d =>
        d.data().cd === dados.cd &&
        d.data().data === dados.data &&
        d.data().nome.toLowerCase() === dados.nome.toLowerCase()
      );
      if (duplicado && !editandoId) {
        alert("Essa solicita√ß√£o j√° existe!");
        return;
      }

      if (editandoId) {
        await updateDoc(doc(db, "solicitacoes", editandoId), dados);
        editandoId = null;
      } else {
        await addDoc(collection(db, "solicitacoes"), dados);
      }

      form.reset();
      carregar();
    });

    function addLinha(id, d) {
      const linha = document.createElement('tr');
      linha.innerHTML = `
        <td>${d.cd}</td>
        <td>${d.nome}</td>
        <td>${d.cargo}</td>
        <td>${d.tipo}</td>
        <td>${d.data}</td>
        <td>${d.qtdSolicitada}</td>
        <td>${d.qtdAprovada}</td>
        <td>${d.obs}</td>
        <td>
          <button class="edit-btn">Editar</button>
          <button class="delete-btn">Excluir</button>
        </td>
      `;
      linha.querySelector('.delete-btn').addEventListener('click', async () => {
        await deleteDoc(doc(db, "solicitacoes", id));
        carregar();
      });
      linha.querySelector('.edit-btn').addEventListener('click', () => {
        cdSelect.value = d.cd;
        nome.value = d.nome;
        cargo.value = d.cargo;
        tipo.value = d.tipo;
        data.value = d.data;
        qtdSolicitada.value = d.qtdSolicitada;
        qtdAprovada.value = d.qtdAprovada;
        obs.value = d.obs;
        editandoId = id;
        window.scrollTo({ top: 0, behavior: "smooth" });
      });
      tabela.appendChild(linha);
    }

    pesquisa.addEventListener('input', () => {
      const termo = pesquisa.value.toLowerCase();
      document.querySelectorAll('#tabelaMochilas tbody tr').forEach(tr => {
        tr.style.display = tr.textContent.toLowerCase().includes(termo) ? "" : "none";
      });
    });

    carregar();
  </script>
</body>
</html>