<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Controle de Solicita√ß√µes de Mochilas</title>

  <!-- Estilos principais -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Poppins", sans-serif; }
    body {
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #333;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 30px 20px;
    }
    .container {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
      padding: 30px;
      width: 100%;
      max-width: 1100px;
      margin-top: 20px;
    }
    h1 {
      text-align: center;
      font-size: 1.8rem;
      margin-bottom: 30px;
      color: #0077b6;
    }
    form { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
    select, input, textarea {
      width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px;
      font-size: 0.95rem; transition: 0.3s;
    }
    select:focus, input:focus, textarea:focus {
      border-color: #00b4d8; outline: none; box-shadow: 0 0 4px rgba(0, 180, 216, 0.5);
    }
    textarea { grid-column: 1 / -1; resize: vertical; min-height: 80px; }
    .btns { display: flex; gap: 10px; grid-column: 1 / -1; margin-top: 10px; justify-content: flex-start; }
    .btn { border: none; padding: 12px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.3s; }
    .btn-primary { background: #007bff; color: #fff; }
    .btn-primary:hover { background: #0069d9; }
    .btn-secondary { background: #444; color: #fff; }
    .btn-secondary:hover { background: #333; }
    table { width: 100%; border-collapse: collapse; margin-top: 25px; }
    th, td { padding: 10px; border-bottom: 1px solid #ccc; text-align: left; }
    th { background: #f5f5f5; color: #007bff; }
    tr:hover { background: #f1f1f1; }
    .editar { background: #00c46a; color: white; border: none; border-radius: 6px; padding: 5px 10px; cursor: pointer; }
    .editar:hover { background: #009f55; }
    .excluir { background: #dc3545; color: white; border: none; border-radius: 6px; padding: 5px 10px; cursor: pointer; }
    .excluir:hover { background: #b02a37; }
    .pesquisa { display: flex; justify-content: flex-end; margin-top: 15px; }
    .pesquisa input { width: 250px; }
    footer { text-align: center; margin-top: 25px; color: #888; font-size: 0.8rem; }
    .select2-container .select2-selection--single {
      height: 42px !important; border-radius: 8px !important;
      border: 1px solid #ccc !important; display: flex; align-items: center;
    }
    .select2-selection__arrow { height: 40px !important; }

    /* üîí Estilos da Tela de Login */
    #loginOverlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.85);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    #loginBox {
      background: #1e293b;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      text-align: center;
      width: 90%;
      max-width: 320px;
      color: white;
    }
    #loginBox h2 { margin-bottom: 20px; color: #00b4d8; }
    #loginBox select, #loginBox input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      border: none;
      outline: none;
      font-size: 1rem;
    }
    #loginBox select { background: #f1f1f1; }
    #loginBox input[type="password"] { background: #fff; }
    #loginBtn {
      background: #00b4d8; color: white; font-weight: 600;
      border: none; padding: 10px; border-radius: 8px;
      cursor: pointer; transition: 0.3s; width: 100%;
    }
    #loginBtn:hover { background: #0077b6; }
  </style>
</head>

<body>
  <!-- üîí Tela de Login -->
  <div id="loginOverlay">
    <div id="loginBox">
      <h2>üîê Acesso Restrito</h2>
      <select id="usuarioSelect">
        <option value="">Selecione seu nome</option>
        <option value="bruna">Bruna</option>
        <option value="elaine">Elaine</option>
        <option value="euclecio">Euclecio</option>
        <option value="pedro">Pedro</option>
      </select>
      <input type="password" id="senhaInput" placeholder="Senha" />
      <button id="loginBtn">Entrar</button>
      <p id="msgErro" style="color:#f87171;margin-top:10px;"></p>
    </div>
  </div>

  <div class="container">
    <h1>üéí Controle de Solicita√ß√µes de Mochilas</h1>

    <form id="formSolicitacao">
      <div>
        <label>Centro de Distribui√ß√£o (CD)</label>
        <select id="cd" class="select2" required style="width: 100%;">
          <option value="">Selecione...</option>
          <!-- Inserindo todos os CDs -->
          <option>CD - Alagoinhas</option>
          <option>CD - Andradina</option>
          <option>CD - Angra dos Reis</option>
          <option>CD - Aparecida de Goi√¢nia</option>
          <option>CD - Ara√ßatuba</option>
          <option>CD - Arapiraca</option>
          <option>CD - Araraquara</option>
          <option>CD - Balsas</option>
          <option>CD - Barbalha</option>
          <option>CD - Barra do Garca</option>
          <option>CD - Barreiras</option>
          <option>CD - Barretos</option>
          <option>CD - Barueri</option>
          <option>CD - Bauru</option>
          <option>CD - Bel√©m</option>
          <option>CD - Boa Vista</option>
          <option>CD - Boituva</option>
          <option>CD - Bom Jesus da Lapa</option>
          <option>CD - Brumado</option>
          <option>CD - Cachoeiro de Itapemirim</option>
          <option>CD - Cama√ßari</option>
          <option>CD - Campina Grande</option>
          <option>CD - Campinas</option>
          <option>CD - Campo Grande MS</option>
          <option>CD - Campo Grande RJ</option>
          <option>CD - Campos dos Goytacazes</option>
          <option>CD - Caraguatatuba</option>
          <option>CD - Cariacica</option>
          <option>CD - Carpina</option>
          <option>CD - Caruaru</option>
          <option>CD - Cascavel</option>
          <option>CD - Catanduva</option>
          <option>CD - Caucaia</option>
          <option>CD - Caxias</option>
          <option>CD - Coimbra</option>
          <option>CD - Conde</option>
          <option>CD - Conselheiro Lafaiete</option>
          <option>CD - Contagem</option>
          <option>CD - Coxim</option>
          <option>CD - Cuiab√°</option>
          <option>CD - Divin√≥polis</option>
          <option>CD - Dourados</option>
          <option>CD - Duque de Caxias</option>
          <option>CD - Eun√°polis</option>
          <option>CD - Eusebio</option>
          <option>CD - Feira de Santana</option>
          <option>CD - Fernand√≥polis</option>
          <option>CD - Floriano</option>
          <option>CD - Garanhuns</option>
          <option>CD - Governador Valadares</option>
          <option>CD - Guaruj√°</option>
          <option>CD - Guarulhos Tabo√£o</option>
          <option>CD - Iguatu</option>
          <option>CD - Imperatriz</option>
          <option>CD - Interlagos</option>
          <option>CD - Ipor√°</option>
          <option>CD - Irece</option>
          <option>CD - Itabaiana</option>
          <option>CD - Itaberaba</option>
          <option>CD - Itabuna</option>
          <option>CD - Itacoatiara</option>
          <option>CD - Itapeva</option>
          <option>CD - Itapissuma</option>
          <option>CD - Itumbiara</option>
          <option>CD - Iuna</option>
          <option>CD - Jaboat√£o dos Guararapes</option>
          <option>CD - Jacobina</option>
          <option>CD - Jaguar√©</option>
          <option>CD - Jequi√©</option>
          <option>CD - Juazeiro</option>
          <option>CD - Juiz de Fora</option>
          <option>CD - Jundia√≠</option>
          <option>CD - Londrina</option>
          <option>CD - Macaiba</option>
          <option>CD - Macei√≥</option>
          <option>CD - Manaus</option>
          <option>CD - Mar√≠lia</option>
          <option>CD - Mogi-Mirim</option>
          <option>CD - Montes Claros</option>
          <option>CD - Mossor√≥</option>
          <option>CD - Muria√©</option>
          <option>CD - Nossa Senhora do Socorro</option>
          <option>CD - Nova Friburgo</option>
          <option>CD - Palho√ßa</option>
          <option>CD - Parana√≠ba</option>
          <option>CD - Parintins</option>
          <option>CD - Parnaiba</option>
          <option>CD - Passos</option>
          <option>CD - Patos</option>
          <option>CD - Paulo Afonso</option>
          <option>CD - Petrolina</option>
          <option>CD - Petr√≥polis</option>
          <option>CD - Picos</option>
          <option>CD - Piracicaba</option>
          <option>CD - Po√ßos de Caldas</option>
          <option>CD - Porto Ferreira</option>
          <option>CD - Porto Velho</option>
          <option>CD - Pouso Alegre</option>
          <option>CD - Praia Grande</option>
          <option>CD - Presidente Prudente</option>
          <option>CD - Recife</option>
          <option>CD - Registro</option>
          <option>CD - Ribeir√£o Preto</option>
          <option>CD - Rio Branco</option>
          <option>CD - Rio das Ostras</option>
          <option>CD - Rio Verde</option>
          <option>CD - Rondon√≥polis</option>
          <option>CD - Salto</option>
          <option>CD - Salvador</option>
          <option>CD - Salvador Leste</option>
          <option>CD - Santa In√™s</option>
          <option>CD - Santa Teresa</option>
          <option>CD - Santo Antonio de Jesus</option>
          <option>CD - S√£o Bernardo</option>
          <option>CD - S√£o Cristov√£o</option>
          <option>CD - S√£o Gon√ßalo</option>
          <option>CD - S√£o Jo√£o de Meriti</option>
          <option>CD - S√£o Jos√© do Rio Preto</option>
          <option>CD - S√£o Jos√© dos Campos</option>
          <option>CD - S√£o Jos√© dos Pinhais</option>
          <option>CD - S√£o Luis</option>
          <option>CD - S√£o Mateus</option>
          <option>CD - S√£o Pedro da Aldeia</option>
          <option>CD - Sapucaia do Sul</option>
          <option>CD - Serra Talhada</option>
          <option>CD - Serrinha</option>
          <option>CD - Sete Lagoas</option>
          <option>CD - Sinop</option>
          <option>CD - Sobral</option>
          <option>CD - Sousa</option>
          <option>CD - Suzano</option>
          <option>CD - Tabatinga</option>
          <option>CD - Tabo√£o da Serra</option>
          <option>CD - Taguatinga</option>
          <option>CD - Taubat√©</option>
          <option>CD - Teixeira de Freitas</option>
          <option>CD - Teresina</option>
          <option>CD - Tr√™s Lagoas</option>
          <option>CD - Uberaba</option>
          <option>CD - Uberl√¢ndia</option>
          <option>CD - Varginha</option>
          <option>CD - Vila Guilherme</option>
          <option>CD - Vit√≥ria da Conquista</option>
          <option>CD - Volta Redonda</option>
        </select>
      </div>

      <div>
        <label>Nome do Solicitante</label>
        <input type="text" id="solicitante" placeholder="Ex: Jo√£o Silva" required />
      </div>

      <div>
        <label>Cargo</label>
        <select id="cargo" class="select2" required style="width: 100%;">
          <option value="">Selecione...</option>
          <option>AC</option>
          <option>SV</option>
          <option>GG</option>
          <option>GV</option>
          <option>ADM</option>
          <option>Financeiro</option>
        </select>
      </div>

      <div>
        <label>Tipo de Solicita√ß√£o</label>
        <select id="tipo" class="select2" required style="width: 100%;">
          <option value="">Selecione...</option>
          <option>Mochila</option>
        </select>
      </div>

      <div>
        <label>Data da Solicita√ß√£o</label>
        <input type="date" id="data" required />
      </div>

      <div>
        <label>Total de Mochilas Solicitadas</label>
        <input type="number" id="solicitadas" min="1" required />
      </div>

      <div>
        <label>Total de Mochilas Aprovadas</label>
        <input type="number" id="aprovadas" min="0" required />
      </div>

      <textarea id="observacoes" placeholder="Informa√ß√µes adicionais"></textarea>

      <div class="btns">
        <button class="btn btn-primary" type="submit">üíæ Salvar Solicita√ß√£o</button>
        <button class="btn btn-secondary" type="button" id="voltarMenu">‚¨ÖÔ∏è Voltar ao Menu</button>
      </div>
    </form>

    <div class="pesquisa">
      <input type="text" id="pesquisa" placeholder="üîç Pesquisar por CD ou nome..." />
    </div>

    <table>
      <thead>
        <tr>
          <th>CD</th>
          <th>Solicitante</th>
          <th>Cargo</th>
          <th>Tipo</th>
          <th>Data</th>
          <th>Solicitadas</th>
          <th>Aprovadas</th>
          <th>Obs</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody id="tabelaSolicitacoes"></tbody>
    </table>

    <footer>¬© 2025 - Controle de Mochilas | Grupo Petr√≥polis</footer>
  </div>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <!-- üîê Script de Login -->
  <script>
    const senhaPadrao = "Petra25";
    function verificarLogin() {
      const usuario = localStorage.getItem("usuarioLogado");
      const overlay = document.getElementById("loginOverlay");
      if (!usuario) overlay.style.display = "flex";
      else overlay.style.display = "none";
    }
    document.getElementById("loginBtn").addEventListener("click", () => {
      const usuario = document.getElementById("usuarioSelect").value;
      const senha = document.getElementById("senhaInput").value;
      const msgErro = document.getElementById("msgErro");
      if (!usuario || !senha) { msgErro.textContent = "Preencha todos os campos!"; return; }
      if (senha !== senhaPadrao) { msgErro.textContent = "Senha incorreta!"; return; }
      localStorage.setItem("usuarioLogado", usuario);
      document.getElementById("loginOverlay").style.display = "none";
    });
    verificarLogin();
  </script>

  <!-- üî• Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBcXTj40CI4fEJOGp2T_ghh3Wwpki4OnW0",
      authDomain: "salasdereunioes-eb91a.firebaseapp.com",
      projectId: "salasdereunioes-eb91a",
      storageBucket: "salasdereunioes-eb91a.firebasestorage.app",
      messagingSenderId: "961898084996",
      appId: "1:961898084996:web:535185ceb0860e1e06e0d1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const form = document.getElementById("formSolicitacao");
    const tabela = document.getElementById("tabelaSolicitacoes");
    const pesquisa = document.getElementById("pesquisa");
    const voltarMenu = document.getElementById("voltarMenu");

    // Ativa busca nos selects
    $(document).ready(function() {
      $('.select2').select2({ placeholder: "Pesquisar...", allowClear: true, width: 'resolve' });
    });

    let alterado = false;
    form.addEventListener("input", () => { alterado = true; });

    voltarMenu.addEventListener("click", () => {
      if (alterado) {
        const confirma = confirm("Voc√™ tem dados n√£o salvos. Deseja sair mesmo assim?");
        if (!confirma) return;
      }
      window.location.href = "index.html";
    });

    async function carregarSolicitacoes() {
      const snap = await getDocs(collection(db, "solicitacoes"));
      const dados = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      mostrarTabela(dados);
    }

    function mostrarTabela(dados) {
      tabela.innerHTML = "";
      dados.forEach(d => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${d.cd}</td>
          <td>${d.nome}</td>
          <td>${d.cargo}</td>
          <td>${d.tipo}</td>
          <td>${d.data}</td>
          <td>${d.qtdSolicitada}</td>
          <td>${d.qtdAprovada}</td>
          <td>${d.obs || ""}</td>
          <td>
            <button class="editar">Editar</button>
            <button class="excluir">Excluir</button>
          </td>
        `;
        tr.querySelector(".excluir").addEventListener("click", async () => {
          if (confirm("Excluir esta solicita√ß√£o?")) {
            await deleteDoc(doc(db, "solicitacoes", d.id));
            carregarSolicitacoes();
          }
        });
        tr.querySelector(".editar").addEventListener("click", async () => {
          const novaQtdAprovada = prompt("Nova quantidade aprovada:", d.qtdAprovada);
          if (novaQtdAprovada !== null) {
            await updateDoc(doc(db, "solicitacoes", d.id), { qtdAprovada: Number(novaQtdAprovada) });
            carregarSolicitacoes();
          }
        });
        tabela.appendChild(tr);
      });
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const cd = document.getElementById("cd").value;
      const nome = document.getElementById("solicitante").value;
      const cargo = document.getElementById("cargo").value;
      const tipo = document.getElementById("tipo").value;
      const data = document.getElementById("data").value;
      const qtdSolicitada = Number(document.getElementById("solicitadas").value);
      const qtdAprovada = Number(document.getElementById("aprovadas").value);
      const obs = document.getElementById("observacoes").value;

      if (!cd || !nome || !cargo || !tipo || !data) return alert("Preencha todos os campos!");

      await addDoc(collection(db, "solicitacoes"), { cd, nome, cargo, tipo, data, qtdSolicitada, qtdAprovada, obs });
      form.reset();
      alterado = false;
      $('.select2').val(null).trigger('change');
      carregarSolicitacoes();
    });

    pesquisa.addEventListener("input", async () => {
      const termo = pesquisa.value.toLowerCase();
      const snap = await getDocs(collection(db, "solicitacoes"));
      const dados = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      const filtrados = dados.filter(d =>
        d.cd.toLowerCase().includes(termo) || d.nome.toLowerCase().includes(termo)
      );
      mostrarTabela(filtrados);
    });

    carregarSolicitacoes();
  </script>
</body>
</html>
